<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Winamp Calc</title>
    <style>
      :root {
        color-scheme: dark;
        --bg-main: #1c1c1c;
        --bg-panel: #2a2a2a;
        --accent: #3aff5c;
        --accent-dark: #16c235;
        --text-dim: #8f8f8f;
        --text-bright: #f2f2f2;
      }

      * {
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle, #2c2c2c 0%, #0b0b0b 70%);
        color: var(--text-bright);
      }

      .deck {
        width: min(360px, 92vw);
        background: linear-gradient(135deg, #202020 0%, #111 100%);
        border: 2px solid #000;
        border-radius: 16px;
        box-shadow: inset 0 0 24px rgba(0, 0, 0, 0.6),
          0 18px 35px rgba(0, 0, 0, 0.7);
        padding: 20px;
        position: relative;
      }

      .display {
        background: #010101;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 12px 16px;
        font-size: 1.6rem;
        font-weight: 600;
        text-align: right;
        letter-spacing: 0.05em;
        color: var(--accent);
        box-shadow: inset 0 0 10px #000;
      }

      .grid {
        margin-top: 18px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }

      button {
        border: none;
        border-radius: 10px;
        padding: 14px 0;
        font-size: 1.15rem;
        font-weight: 600;
        color: #111;
        background: linear-gradient(180deg, var(--accent) 0%, var(--accent-dark) 100%);
        box-shadow: 0 4px #0f5f1f;
        cursor: pointer;
        transition: transform 0.1s ease, filter 0.2s ease;
      }

      button.danger {
  background: linear-gradient(180deg, #ff5a5a 0%, #c20000 100%);
  box-shadow: 0 4px #6a0000;
  color: #fff;
}

button.danger:active {
  box-shadow: 0 2px #6a0000;
}






      button:active {
        transform: translateY(2px);
        box-shadow: 0 2px #0f5f1f;
      }

      button.operator {
        background: linear-gradient(180deg, #ffce3a 0%, #fd9c00 100%);
        box-shadow: 0 4px #b26500;
      }

      button.wide {
        grid-column: span 2;
      }

      .chrome-line {
        margin-top: 20px;
        height: 4px;
        background: linear-gradient(
          90deg,
          #646464 0%,
          #eeeeee 30%,
          #777777 60%,
          #222222 100%
        );
        border-radius: 999px;
      }

      .metronome {
        margin-top: 18px;
        background: var(--bg-panel);
        border: 1px solid #000;
        border-radius: 12px;
        padding: 14px 16px;
        box-shadow: inset 0 0 12px #000;
      }

      .metronome h2 {
        margin: 0 0 10px;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        color: var(--text-dim);
      }

      .metronome-controls {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .metronome button {
        font-size: 0.95rem;
        padding: 8px 16px;
        flex-shrink: 0;
      }

      .tempo {
        display: flex;
        flex-direction: column;
        gap: 4px;
        flex-grow: 1;
      }

      .tempo label {
        font-size: 0.8rem;
        color: var(--text-dim);
      }

      input[type="range"] {
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        background: #0e0e0e;
        border-radius: 5px;
        border: 1px solid #000;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: var(--accent);
        border: 1px solid #000;
        box-shadow: 0 0 5px var(--accent);
      }

      small {
        display: block;
        text-align: center;
        margin-top: 14px;
        color: var(--text-dim);
        letter-spacing: 0.1em;
      }
    </style>
  </head>
  <body>
    <main class="deck">
      <section class="display" id="display">0</section>
      <section class="grid" id="keys">
        <button data-action="clear" class="danger">AC</button>
        <button data-action="sign">±</button>
        <button data-action="percent">%</button>
        <button class="operator" data-action="operator" data-value="/">÷</button>
        <button data-value="7">7</button>
        <button data-value="8">8</button>
        <button data-value="9">9</button>
        <button class="operator" data-action="operator" data-value="*">×</button>
        <button data-value="4">4</button>
        <button data-value="5">5</button>
        <button data-value="6">6</button>
        <button class="operator" data-action="operator" data-value="-">−</button>
        <button data-value="1">1</button>
        <button data-value="2">2</button>
        <button data-value="3">3</button>
        <button class="operator" data-action="operator" data-value="+">+</button>
        <button class="wide" data-value="0">0</button>
        <button data-action="decimal">,</button>
        <button  data-action="calculate" class="danger">=</button>
      </section>

      <div class="chrome-line"></div>

      <section class="metronome">
        <h2>metronome</h2>
        <div class="metronome-controls">
          <button id="metro-toggle">Старт</button>
          <div class="tempo">
            <label for="tempo">Темп: <span id="tempo-value">555</span> BPM</label>
            <input type="range" id="tempo" min="20" max="555" value="120" />
          </div>
        </div>
      </section>

      <small>Winamp vibes • JS калькулятор + метроном</small>
    </main>

    <script>
      const display = document.getElementById("display");
      const keys = document.getElementById("keys");
      const metroToggle = document.getElementById("metro-toggle");
      const tempoSlider = document.getElementById("tempo");
      const tempoValue = document.getElementById("tempo-value");

      const state = {
        displayValue: "0",
        firstOperand: null,
        waitingForSecondOperand: false,
        operator: null,
      };

      function updateDisplay() {
        display.textContent = state.displayValue.replace(".", ",");
      }

      function inputDigit(digit) {
        if (state.waitingForSecondOperand) {
          state.displayValue = digit;
          state.waitingForSecondOperand = false;
        } else {
          state.displayValue =
            state.displayValue === "0" ? digit : state.displayValue + digit;
        }
      }

      function inputDecimal() {
        if (state.waitingForSecondOperand) {
          state.displayValue = "0.";
          state.waitingForSecondOperand = false;
          return;
        }
        if (!state.displayValue.includes(".")) {
          state.displayValue += ".";
        }
      }

      const performCalculation = {
        "/": (first, second) => first / second,
        "*": (first, second) => first * second,
        "+": (first, second) => first + second,
        "-": (first, second) => first - second,
        "=": (_, second) => second,
      };

      function handleOperator(nextOperator) {
        const inputValue = parseFloat(state.displayValue);
        if (state.operator && state.waitingForSecondOperand) {
          state.operator = nextOperator;
          return;
        }

        if (state.firstOperand === null && !Number.isNaN(inputValue)) {
          state.firstOperand = inputValue;
        } else if (state.operator) {
          const result = performCalculation[state.operator](
            state.firstOperand,
            inputValue
          );
          state.displayValue = `${parseFloat(result.toFixed(9))}`;
          state.firstOperand = result;
        }

        state.waitingForSecondOperand = true;
        state.operator = nextOperator;
      }

      function resetCalculator() {
        state.displayValue = "0";
        state.firstOperand = null;
        state.waitingForSecondOperand = false;
        state.operator = null;
      }

      function handlePercent() {
        const value = parseFloat(state.displayValue);
        if (!Number.isNaN(value)) {
          state.displayValue = `${value / 100}`;
        }
      }

      function handleSign() {
        const value = parseFloat(state.displayValue);
        if (!Number.isNaN(value)) {
          state.displayValue = `${value * -1}`;
        }
      }

      keys.addEventListener("click", (event) => {
        const target = event.target;
        if (!target.matches("button")) {
          return;
        }

        const { action, value } = target.dataset;

        if (value && !action) {
          inputDigit(value);
          updateDisplay();
          return;
        }

        if (action === "decimal") {
          inputDecimal();
          updateDisplay();
          return;
        }

        if (action === "clear") {
          resetCalculator();
          updateDisplay();
          return;
        }

        if (action === "sign") {
          handleSign();
          updateDisplay();
          return;
        }

        if (action === "percent") {
          handlePercent();
          updateDisplay();
          return;
        }

        if (action === "operator") {
          handleOperator(target.dataset.value);
          return;
        }

        if (action === "calculate") {
          handleOperator("=");
          updateDisplay();
        }
      });

      // ----- Метроном -----
      let audioCtx = null;
      let metronomeInterval = null;

      function playTick() {
        if (!audioCtx) {
          return;
        }
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = "square";
        osc.frequency.value = 555;
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(
          0.001,
          audioCtx.currentTime + 0.1
        );
        osc.connect(gain).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
      }

      function toggleMetronome() {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        if (metronomeInterval) {
          clearInterval(metronomeInterval);
          metronomeInterval = null;
          metroToggle.textContent = "Старт";
          metroToggle.classList.remove("operator");
          return;
        }

        const tempoMs = (60 / parseInt(tempoSlider.value, 10)) * 1000;
        playTick();
        metronomeInterval = setInterval(playTick, tempoMs);
        metroToggle.textContent = "Стоп";
        metroToggle.classList.add("operator");
      }

      metroToggle.addEventListener("click", () => {
        toggleMetronome();
      });

      tempoSlider.addEventListener("input", () => {
        tempoValue.textContent = tempoSlider.value;
        if (metronomeInterval) {
          clearInterval(metronomeInterval);
          const tempoMs = (60 / parseInt(tempoSlider.value, 10)) * 1000;
          metronomeInterval = setInterval(playTick, tempoMs);
        }
      });

      updateDisplay();
    </script>
  </body>
</html>

